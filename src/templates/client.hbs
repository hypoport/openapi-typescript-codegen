import { constructExternalUrl } from '@hypoport/ampr-homecloud-common';
import { createContainer } from 'thirty/inject';

{{#each services}}
import { {{{name}}}{{{@root.postfix}}}, {{{lowerCase name}}}{{{@root.postfix}}}Factory } from './services/{{{name}}}{{{@root.postfix}}}';
{{/each}}
import { httpClientFactory } from '../http/http-client';

export class HomecloudApiService {
  {{#each services}}
  readonly {{{lowerCase name}}}Api: {{{name}}}{{{@root.postfix}}};
  {{/each}}

  constructor(stage: 'prod' | 'test' | 'int') {
    const config = createContainer({
      baseUrl: () => constructExternalUrl(stage, 'api'),
      httpClient: httpClientFactory,
      {{#each services}}
      {{{lowerCase name}}}ApiService: {{{lowerCase name}}}{{{@root.postfix}}}Factory,
      {{/each}}
    });

    {{#each services}}
    this.{{{lowerCase name}}}Api = config.{{{lowerCase name}}}{{{@root.postfix}}};
    {{/each}}
  }
}
